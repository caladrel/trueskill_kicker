<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Die QI-Kickerliga</title>
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap-theme.min.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <style type="text/css">
body {
  padding-top: 70px;
}

.asteriskField {
    display: none;
}
th.num {
    text-align: right;
}
td.num {
    text-align: right;
    font-family: Menlo,Monaco,Consolas,"Courier New",Monospace;
}
    </style>
    {% block header %}{% endblock %}
</head>
<body>
    <div class="navbar navbar-inverse navbar-fixed-top">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="{% url 'league:index' %}">
                    QI Kickerliga</a>
            </div>
            <div class="collapse navbar-collapse">
                {% block navigation %}
                <ul class="nav navbar-nav">
                    {% block navigation_matches %}
                    <li><a href="{% url 'league:index' %}">Matches</a></li>
                    {% endblock %}
                    {% block navigation_players %}
                    <li><a href="{% url 'league:players' %}">Players</a></li>
                    {% endblock %}
                    {% block navigation_top %}
                    <li><a href="{% url 'league:players_top' %}">Top ten</a></li>
                    {% endblock %}
                    {% block navigation_about %}
                    <li><a href="{% url 'league:about' %}">About</a></li>
                    {% endblock %}
                </ul>
                <form id="available" class="navbar-form navbar-right" style="display:none">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Player">
                    </div>
                    <button type="submit" class="btn btn-primary">I'm available</button>
                </form>
                <form id="seeking" class="navbar-form navbar-right" style="display:none">
                    <button class="cancel btn btn-default">I'm not available</button>
                    <button type="submit" class="btn btn-primary">I want to play now</button>
                </form>
                <ul class="nav navbar-nav navbar-right">
                    {% load simplecookie_state_selector %}
                    {% state_selector 'c' c='Combined mode' a='Attacker mode' d='Defender mode' %}
                </ul>
                {% endblock %}
            </div><!--/.nav-collapse -->
        </div>
    </div>
    <div id="content" class="container">
        {% block content %}{% endblock %}
    </div>
    <script src="//code.jquery.com/jquery.js"></script>
    <script src="//netdna.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script>

var socket = io();
var $available = $('#available'),
    $seeking = $('#seeking'),
    $namefield = $available.find('input');

socket.on('check', function(data) {
    if (confirm("'" + data + "' want's to play\nare you ready to play right now?")) {
        socket.emit('ready', $namefield.val());
        $seeking.hide();
        $available.show();
    } else {
    }
    console.log(data);
});

socket.on('ready', function(data) {
    var message,
        alert = '<div class="alert alert-info" alert-dismissable role="alert">' +
            '<button type="button" class="close" data-dismiss="alert" aria-label="Close">' +
            '<span aria-hidden="true">&times;</span>' +
            '</button><span id="alertmsg"></span></div>';
    if (data.length == 1) message = 'player ' + data.join(', ') + ' is ready';
    else  message = 'players ' + data.join(', ') + ' are ready'
    if (!$('.alert')[0]) $('#content').prepend(alert);
    $('#alertmsg').empty().append(message);
});

socket.on('finished', function(data) {
    $('.alert-info').removeClass('alert-info').addClass('alert-success');
});

$(document).ready(function() {
    $available.show();
});

$available.submit(function (event) {
    $available.hide();
    $seeking.show();
    event.preventDefault();
    socket.emit('available', $namefield.val());
});
$seeking.submit(function (event) {
    $seeking.hide();
    $available.show();
    event.preventDefault();
    socket.emit('checkready', $namefield.val());
});
$('#seeking > .cancel').click(function (event) {
    $seeking.hide();
    $available.show();
    event.preventDefault();
    socket.emit('unavailable', $namefield.val());
});
    </script>
</body>
</html>
